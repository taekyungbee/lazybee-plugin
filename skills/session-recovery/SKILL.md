---
description: "세션 복구 가이드. Edit 연쇄 실패, 컨텍스트 포화, 도구 타임아웃, 반복 실패 등 세션 문제 발생 시 체계적 복구 절차를 안내합니다."
triggers:
  - "세션 복구"
  - "session recovery"
  - "에러 반복"
  - "계속 실패"
  - "같은 에러"
  - "무한 루프"
  - "진행이 안 돼"
  - "막혔어"
---

# 세션 복구 가이드

## 시나리오 1: Edit 연쇄 실패

### 증상
- "oldString not found" 반복 발생
- Edit 시도가 3회 이상 연속 실패

### 복구 절차

1. **즉시 중단**: 동일 패턴으로 재시도하지 않기
2. **파일 다시 읽기**: Read 도구로 해당 파일 전체 내용 확인
3. **실제 내용 확인**: 예상과 다른 부분 파악
4. **정확한 문자열로 재시도**: 복사한 실제 문자열 사용

```
규칙: Edit 2회 실패 시 반드시 Read로 파일을 다시 읽는다.
```

### 흔한 원인
- 이전 Edit으로 파일 내용이 변경됨
- 들여쓰기(탭 vs 스페이스) 불일치
- 줄바꿈 문자 차이 (LF vs CRLF)
- 해당 코드가 이미 삭제/이동됨

---

## 시나리오 2: 컨텍스트 윈도우 포화

### 증상
- 응답이 점점 짧아지거나 불완전
- 이전 대화 내용을 잊어버림
- 상태바에 COMPRESS? 또는 CRITICAL 표시

### 복구 절차

1. **현재 상태 정리**: 진행 중인 작업과 남은 작업 목록화
2. **불필요한 출력 회피**: 큰 파일 전체 읽기 대신 필요한 부분만 읽기
3. **구체적 검색 사용**: 넓은 Grep 대신 정확한 패턴 + 경로 지정
4. **새 세션 고려**: 80% 이상이면 현재 진행 상황을 정리하고 새 세션 시작 권장

```
규칙: 컨텍스트 80% 초과 시 새 세션으로 전환을 고려한다.
       전환 전 진행 상황과 남은 작업을 파일에 기록한다.
```

### 컨텍스트 절약 팁
- `Read`에 `offset`/`limit` 파라미터 활용
- `Grep`에 `head_limit` 파라미터 활용
- `Glob`에 구체적 패턴 사용 (`**/*.ts` 대신 `src/api/**/*.ts`)
- 대량 출력이 예상되는 명령은 `| head -20` 제한

---

## 시나리오 3: 도구 실행 타임아웃

### 증상
- Bash 명령이 타임아웃으로 중단
- 빌드나 테스트가 시간 내 완료되지 않음

### 복구 절차

1. **범위 축소**: 전체 빌드 대신 변경 파일만 타입체크
2. **타임아웃 연장**: `timeout` 파라미터를 늘려서 재시도
3. **백그라운드 실행**: `run_in_background: true`로 긴 작업 실행
4. **분할 실행**: 큰 작업을 작은 단위로 나누어 순차 실행

```
규칙: 타임아웃 발생 시 동일 명령 재시도 대신 범위를 축소한다.
```

### 대체 명령 예시
| 타임아웃 발생 | 대체 명령 |
|-------------|----------|
| `pnpm build` | `pnpm tsc --noEmit` (타입만 체크) |
| `pnpm test` | `pnpm vitest run <변경파일>` |
| `pnpm lint` | `pnpm eslint <변경파일>` |
| `npm install` | `npm install --prefer-offline` |

---

## 시나리오 4: 빌드/테스트 반복 실패

### 증상
- 같은 에러로 3회 이상 빌드/테스트 실패
- 수정해도 다른 곳에서 새로운 에러 발생 (연쇄 실패)

### 복구 절차

1. **3회 규칙 적용**: 동일 접근으로 3회 실패 시 **접근 방식 변경**
2. **에러 분류**: 타입 에러 / 런타임 에러 / 로직 에러 구분
3. **근본 원인 추적**: 가장 먼저 발생한 에러부터 해결
4. **변경 롤백 고려**: 마지막 성공 상태로 돌아간 후 다른 방식 시도

```
규칙: 3회 실패 시 같은 방법 재시도 금지. 접근 방식을 변경한다.
```

### 접근 방식 변경 예시
- **타입 에러 연쇄**: 인터페이스/타입을 먼저 확정한 후 구현
- **import 에러**: 순환 참조 확인, barrel export 문제 점검
- **테스트 실패**: 테스트 자체의 기대값이 올바른지 확인
- **빌드 실패**: `node_modules` 삭제 후 재설치

---

## 일반 복구 원칙

1. **같은 실수 반복 금지**: 2회 실패한 접근은 다른 방법 시도
2. **상태 확인 우선**: 수정 전에 항상 현재 상태부터 파악
3. **작은 단위로 진행**: 한 번에 큰 변경 대신 작은 변경 + 검증 반복
4. **기록 남기기**: 무엇이 실패했고 왜 실패했는지 정리
5. **사용자에게 보고**: 해결이 어려운 경우 현재 상황과 시도한 방법 공유
